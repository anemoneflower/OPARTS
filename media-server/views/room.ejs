<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"></script>

    <title>
      <%= user_name %>@<%= room_name %>
    </title>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/modules/mediasoupclient.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/EventEmitter/5.2.8/EventEmitter.min.js"></script>
    <script src="/js/RoomClient.js"></script>
    <link rel="stylesheet" href="/css/room.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css" />
  </head>

  <body>
    <!-- Left Layout -->
    <div id="left">
      <!-- Videos -->
      <div id="remote-media">
        <div name="local-media" id="local-media" class="video-container">
          <p class="name-overlay">
            <%= user_name %>
          </p>
          <video id="local-video" autoplay inline></video>
        </div>
      </div>
      <!-- <div name="local-media" id="local-media" class="video-container">
        <p class="name-overlay"><%= user_name %></p>
        <video id="local-video" autoplay inline></video>
      </div> -->

      <!--Map-->
      <!-- <iframe style="border: 1px solid grey; margin: 10px 0px 0px 5px; width: 100%; height: 80%;" src="../map.html"></iframe> -->
      <div class="tab">
        <button class="tablinks" onclick="showMap('../img/day1-map.png');">1일차<br>(명동)</button>
        <button class="tablinks" onclick="showMap('../img/day2-map.png');">2일차<br>(강남)</button>
      </div>
      <div id="map-view" class="tabcontent">
        <img id="map-image" style="width: 100%; height: 100%" src="../img/day1-map.png">
      </div>

      <!-- Bottom Navbar Buttons -->
      <nav class="navbar navbar-expand-lg fixed-bottom">
        <div id="media-control" class="container-fluid btn-toolbar d-grid gap-2 d-md-block" role="toolbar">
          <!-- invite button -->
          <div class="btn-group me-2" role="group">
            <button class="btn btn-outline-success btn-md shadow-none" onclick="copyJoinLink()">
              <i class="fas fa-users"></i>
              Invite
            </button>
          </div>
          <!-- Video button -->
          <div class="btn-group btn-group-md dropup me-2" role="group">
            <button type="button" class="btn btn-outline-primary btn-md shadow-none mx-auto" id="start-video-button"
              style="display: none"
              onclick="this.disabled = true; rc.produce(RoomClient.mediaType.video, document.getElementById('video-select').value); rc.addUserLog(Date.now(), 'Video ON\n');">
              <i class="fas fa-video-slash"></i>
              Show Video
            </button>
            <button type="button" id="stop-video-button" style="display: none"
              class="btn btn-outline-primary btn-md shadow-none rounded-start"
              onclick="this.disabled = true; rc.closeProducer(RoomClient.mediaType.video); rc.addUserLog(Date.now(), 'Video OFF\n');">
              <i class="fas fa-video"></i>
              Hide Video
            </button>
            <button type="button" class="
                btn btn-outline-primary btn-md
                shadow-none
                dropdown-toggle dropdown-toggle-split
              " data-bs-toggle="dropdown" aria-expanded="false">
              <span class="visually-hidden">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
              <li>
                <h6 class="dropdown-header">Available Video Sources</h6>
              </li>
              <select id="video-select" class="form-select form-select-sm shadow-none"></select>
            </ul>
          </div>
          <div class="btn-group dropup me-2" role="group">
            <button type="button" id="start-audio-button" style="display: none"
              class="btn btn-outline-primary btn-md shadow-none"
              onclick="this.disabled = true; rc.produce(RoomClient.mediaType.audio, document.getElementById('audio-select').value); rc.addUserLog(Date.now(), 'Audio ON\n');">
              <i class="fas fa-volume-mute"></i>
              Open Audio
            </button>
            <button type="button" id="stop-audio-button" style="display: none"
              class="btn btn-outline-primary btn-md shadow-none rounded-start"
              onclick="this.disabled = true; rc.closeProducer(RoomClient.mediaType.audio); rc.addUserLog(Date.now(), 'Audio OFF\n');">
              <i class="fas fa-volume-up"></i>
              Close Audio
            </button>
            <button type="button" class="
                btn btn-outline-primary btn-md
                shadow-none
                dropdown-toggle dropdown-toggle-split
              " data-bs-toggle="dropdown" aria-expanded="false">
              <span class="visually-hidden">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
              <li>
                <h6 class="dropdown-header">Available Audio Sources</h6>
              </li>
              <select id="audio-select" class="form-select form-select-sm shadow-none"></select>
            </ul>
          </div>
          <!-- <div class="btn-group" role="group">
            <button
              id="screen-share"
              class="btn btn-outline-primary btn-md shadow-none"
              onclick="startScreenSharing()"
            >
              <i class="fas fa-chevron-up"></i>
              Share Screen
            </button>
          </div> -->
        </div>
      </nav>
    </div>

    <div id="right">
      <div class="border bg-light bg-gradient" id="display-choice">
        <p class="h5" style="margin-bottom: 0.5em; display: inline-block;"><strong>AI Moderator</strong></p>

        <div class="dropdown" style="display: block; margin-top: 5px; float: right;">
          <button style="border-radius: 5px; font-size: smaller;" onclick="showPinBoxes();">
            <i class="fas fa-thumbtack"></i> 고정 <i class="fas fa-caret-down"></i>
          </button>
          <div id="dropdownPin" style="display: none; position: absolute; right: 0" class="dropdown-pin"></div>
        </div>
      
        <div style="margin-top: 1em; ">
          <input type="text" id="search-word" placeholder="SEARCH"
            onkeydown="checkEnter(event); rc.addUserLog(Date.now(), 'Search\n');">
          <button type="button" onclick="displayUnitOfBox(); rc.addUserLog(Date.now(), 'Search Button\n');" width="50px" style="padding: 3.5px; background-color:yellowgreen; margin: 2px; border: none; border-radius: 5px;">
            <!--<img src="/img/search.png" width="30px" style="padding: 0px; margin: 0px;">-->
            <i class="fas fa-search" width="30px", style="padding: 0px; color:white; background-color: transparent; margin: 0px;"></i>
          </button>
          <button type="button" onclick="showAllBoxes(); rc.addUserLog(Date.now(), 'ShowAll Button\n');" width="30px" style="padding: 3px; background-color:palevioletred; margin: 2px; border: none; border-radius: 5px;">
            <i class="fas fa-backspace" width="30px", style="padding: 0px; color:white; background-color: transparent; margin: 0px;"></i>
          </button>
        </div>

        <!--Add buttons for trending keyword-->
        <div id="keywords-list" style="margin-top: 5px;">
          <p style="font-size:medium; display: inline-block; margin-bottom: 5px;"><strong>실시간 인기: </strong></p>
          <button type="button" id="trending-1" onclick="displayTrendingHelper(this);" style="font-size: smaller; padding: 1px 3px 1px 3px; margin-top: 2px; border-radius: 5px; border: 1px solid black;" >#1</button>
          <button type="button" id="trending-2" onclick="displayTrendingHelper(this);" style="font-size: smaller; padding: 1px 3px 1px 3px; margin-top: 2px; border-radius: 5px; border: 1px solid black;" >#2</button>
          <button type="button" id="trending-3" onclick="displayTrendingHelper(this);" style="font-size: smaller; padding: 1px 3px 1px 3px; margin-top: 2px; border-radius: 5px; border: 1px solid black;" >#3</button>
          <button type="button" id="trending-4" onclick="displayTrendingHelper(this);" style="font-size: smaller; padding: 1px 3px 1px 3px; margin-top: 2px; border-radius: 5px; border: 1px solid black;" >#4</button>
          <button type="button" id="trending-5" onclick="displayTrendingHelper(this);" style="font-size: smaller; padding: 1px 3px 1px 3px; margin-top: 2px; border-radius: 5px; border: 1px solid black;" >#5</button>
          <button type="button" id="trending-6" onclick="displayTrendingHelper(this);" style="font-size: smaller; padding: 1px 3px 1px 3px; margin-top: 2px; border-radius: 5px; border: 1px solid black;" >#6</button>
          <button type="button" id="trending-7" onclick="displayTrendingHelper(this);" style="font-size: smaller; padding: 1px 3px 1px 3px; margin-top: 2px; border-radius: 5px; border: 1px solid black;" >#7</button>
          <button type="button" id="trending-8" onclick="displayTrendingHelper(this);" style="font-size: smaller; padding: 1px 3px 1px 3px; margin-top: 2px; border-radius: 5px; border: 1px solid black;" >#8</button>
          <button type="button" id="trending-9" onclick="displayTrendingHelper(this);" style="font-size: smaller; padding: 1px 3px 1px 3px; margin-top: 2px; border-radius: 5px; border: 1px solid black;" >#9</button>
          <button type="button" id="trending-10" onclick="displayTrendingHelper(this);" style="font-size: smaller; padding: 1px 3px 1px 3px; margin-top: 2px; border-radius: 5px; border: 1px solid black;" >#10</button>
        </div>
        <div id="favorites">
          <p style="font-size: medium; display: inline-block; margin-bottom: 5px;"><strong>즐겨찾기: </strong></p>
          <button state="off" type="button" id="del-keyword" onclick="delFavorite();" style="float: right; font-size: smaller; margin-left: 5px; padding: 1px 3px 1px 3px; border-radius: 5px;" ><i class="fas fa-minus"></i> 삭제</button>
          <button type="button" id="my-keyword" onclick="addFavorite();" style="float: right; font-size: smaller; padding: 1px 3px 1px 3px; border-radius: 5px;" ><i class="fas fa-plus"></i> 추가</button>
        </div>
      </div>
      <div id="messages" style="clear: both;"></div>


      <button type="button" onclick="scrollDown(); rc.addUserLog(Date.now(), 'Scroll Down\n');" width="80px" style="padding: 0px; margin: 0px; border: none; border-radius: 0px;">
        <img src="/img/scrolldown.png" style="width: 100px;"style="padding: 0px; margin: 0px;">
      </button>

      <button type="button" onclick="openSubtask();" style="font-size: small; margin-top: 10px; margin-right: 10px; float: right; border-radius: 5px;">
        설문 풀기
      </button>
      <button type="button" onclick="openMap();" style="font-size: small; margin-top: 10px; margin-right: 10px; float: right; border-radius: 5px;">
        지도 보기
      </button>

      <script>
        function showMap(src) {
          let mapContent = document.getElementById('map-image');
          mapContent.src = src;
        }

      </script>
  </body>

  <footer>
    <script>
      const room_id = "<%= room_id %>";
      const room_name = "<%= room_name%>";
      const user_name = "<%= user_name %>";
      const moderator_hostname = "<%= moderator_hostname %>";
      const moderator_port = "<%= moderator_port %>";
    </script>
    <script src="/js/conference.js"></script>
    <script src="/js/speech.js"></script>
    <script src="/js/transcript.js"></script>
  </footer>

</html>
