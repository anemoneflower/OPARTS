<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"></script>

    <title>
      <%= user_name %>@<%= room_name %>
    </title>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/modules/mediasoupclient.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/EventEmitter/5.2.8/EventEmitter.min.js"></script>
    <script src="/js/RoomClient.js"></script>
    <link rel="stylesheet" href="/css/room.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css" />
  </head>

  <body>
    <div id="overlay">
      <button id="text" class="btn btn-primary btn-lg shadow-none" style="margin: 0;
              position: absolute;
              top: 50%;
              left: 50%;
              -ms-transform: translate(-50%, -50%);
              transform: translate(-50%, -50%);">Please close the pop-up window to view the minutes!</button>
    </div>

    <!-- The Modal -->
    <div id="subtaskModal" class="modal">
      <!-- Modal content -->
      <div class="modal-content">
        <div class="modal-header">
          <span class="closeModal">&times;</span>
          <h2>Experiment Instructions</h2>
        </div>
        <div class="modal-body">
          <p style='font-weight: bold;'>Please start your subtask before the meeting ends.</p>
          <p>If you click the subtask button at the bottom, you can start the subtask.</p>
        </div>
      </div>
    </div>

    <!-- Left Layout -->
    <div id="left">
      <!-- Videos -->
      <div id="remote-media">
        <div name="local-media" id="local-media" class="video-container">
          <p class="name-overlay">
            <%= user_name %>
          </p>
          <video id="local-video" autoplay inline></video>
        </div>
      </div>
      <!-- <div name="local-media" id="local-media" class="video-container">
        <p class="name-overlay"><%= user_name %></p>
        <video id="local-video" autoplay inline></video>
      </div> -->

      <div class="tab">
        <button id="note-write" class="tablinks btn btn-outline-dark btn-md rounded-top shadow-none"
          onclick="showTap('Write'); get_position_of_mousePointer(event, 'NoteW'); rc.addUserLog(Date.now(), 'CLICK-Note-Write\n');"
          hidden>Write minute
        </button>
        <button id="note-1" class="tablinks btn btn-outline-dark btn-md rounded-top shadow-none"
          onclick="showTap('Note1'); rc.addUserLog(Date.now(), 'CLICK-Note-1\n');" hidden>Minute 1
        </button>
        <button id="note-2" class="tablinks btn btn-outline-dark btn-md rounded-top shadow-none"
          onclick="showTap('Note2'); rc.addUserLog(Date.now(), 'CLICK-Note-2\n');" hidden>Minute 2
        </button>
        <button id="note-3" class="tablinks btn btn-outline-dark btn-md rounded-top shadow-none"
          onclick="showTap('Note3'); rc.addUserLog(Date.now(), 'CLICK-Note-3\n');" hidden>Minute 3
        </button>
        <button id="note-4" class="tablinks btn btn-outline-dark btn-md rounded-top shadow-none"
          onclick="showTap('Note4'); rc.addUserLog(Date.now(), 'CLICK-Note-4\n');" hidden>Minute 4
        </button>
        <button id="task" class="tablinks btn btn-dark btn-md rounded-top shadow-none"
          onclick="showTap('Task'); get_position_of_mousePointer(event, 'TASK'); rc.addUserLog(Date.now(), 'CLICK-TASK-IMG\n');">
          Information
        </button>
      </div>
      <div id="note-view" class="tabcontent">
        <!-- TODO: @anemoneflower md-style? -->
        <div class="m-3" id="notepad-group" hidden>
          <textarea class="form-control shadow-none" id="notepad" rows="3" style="width: 100%; height: 80%;"
            onkeyup="save_note()"></textarea>
          <button type="button" onclick="save_note()" class="btn btn-warning btn-md shadow-none fw-bold">
            Save
          </button>
          <span id="saveTag-writer"></span>
        </div>
        <div id="notearea-1" hidden>
          <p class="m-3" id="notepad-1" style="white-space: pre-line;"> Minute 1 is empty. </p>
          <span id="saveTag-viewer-1"></span>
        </div>
        <div id="notearea-2" hidden>
          <p class="m-3" id="notepad-2" style="white-space: pre-line;"> Minute 2 is empty. </p>
          <span id="saveTag-viewer-2"></span>
        </div>
        <div id="notearea-3" hidden>
          <p class="m-3" id="notepad-3" style="white-space: pre-line;"> Minute 3 is empty. </p>
          <span id="saveTag-viewer-3"></span>
        </div>
        <div id="notearea-4" hidden>
          <p class="m-3" id="notepad-4" style="white-space: pre-line;"> Minute 4 is empty. </p>
          <span id="saveTag-viewer-4"></span>
        </div>
        <img id="task-img" src="../img/task.png" style="width: 100%; height: 100%;" hidden></img>
        <div id="taskarea">
          <h1>Tasks</h1>
          <hr>
          <h2>Main Task</h2>
          <p>30-minute meeting on the topic "Is a college education worth it?"</p>
          <h2>Individual subtask</h2>
          <p>Write answers on the subtask by clicking the red "Start Subtask" button during the meeting. You should end
            this subtask before the meeting ends.</p>
          <hr>
          <h1>General Informaion</h1>
          <hr>
          <p>추후 이전과 같이 이미지로 업데이트 될 예정입니다.</p>
        </div>
      </div>

      <!-- Bottom Navbar Buttons -->
      <nav id="left-navbar" class="navbar navbar-expand-lg fixed-bottom">
        <div id="media-control" class="container-fluid btn-toolbar d-grid gap-2 d-md-block" role="toolbar">
          <div class="btn-group me-2" role="group">
            <button id="meeting-timer" class="btn btn-outline-secondary btn-md shadow-none disabled">
              <i class="fas fa-hourglass-start"></i>
              Remaining Time (30m 0s)
            </button>
            </button>
          </div>
          <!-- invite button -->
          <div class="btn-group me-2" role="group">
            <button id="invite-btn" class="btn btn-outline-success btn-md shadow-none" onclick="copyJoinLink()" hidden>
              <i class="fas fa-users"></i>
              Invite
            </button>
          </div>
          <!-- Video button -->
          <div class="btn-group btn-group-md dropup me-2" role="group">
            <button type="button" class="btn btn-outline-primary btn-md shadow-none mx-auto" id="start-video-button"
              style="display: none"
              onclick="get_position_of_mousePointer(event, 'VIDEO'); this.disabled = true; rc.produce(RoomClient.mediaType.video, document.getElementById('video-select').value); rc.addUserLog(Date.now(), 'VIDEO-ON\n');">
              <i class="fas fa-video-slash"></i>
              Show Video
            </button>
            <button type="button" id="stop-video-button" style="display: none"
              class="btn btn-outline-primary btn-md shadow-none rounded-start"
              onclick="get_position_of_mousePointer(event, 'VIDEO'); this.disabled = true; rc.closeProducer(RoomClient.mediaType.video); rc.addUserLog(Date.now(), 'VIDEO-OFF\n');">
              <i class="fas fa-video"></i>
              Hide Video
            </button>
            <button type="button" class="
                btn btn-outline-primary btn-md
                shadow-none
                dropdown-toggle dropdown-toggle-split
              " data-bs-toggle="dropdown" aria-expanded="false">
              <span class="visually-hidden">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
              <li>
                <h6 class="dropdown-header">Available Video Sources</h6>
              </li>
              <select id="video-select" class="form-select form-select-sm shadow-none"></select>
            </ul>
          </div>
          <div class="btn-group dropup me-2" role="group">
            <button type="button" id="start-audio-button" style="display: none"
              class="btn btn-outline-primary btn-md shadow-none"
              onclick="get_position_of_mousePointer(event, 'AUDIO'); this.disabled = true; rc.produce(RoomClient.mediaType.audio, document.getElementById('audio-select').value); rc.addUserLog(Date.now(), 'AUDIO-ON\n');">
              <i class="fas fa-volume-mute"></i>
              Open Audio
            </button>
            <button type="button" id="stop-audio-button" style="display: none"
              class="btn btn-outline-primary btn-md shadow-none rounded-start"
              onclick="get_position_of_mousePointer(event, 'AUDIO'); this.disabled = true; rc.closeProducer(RoomClient.mediaType.audio); rc.addUserLog(Date.now(), 'AUDIO-OFF\n');">
              <i class="fas fa-volume-up"></i>
              Close Audio
            </button>
            <button type="button" class="
                btn btn-outline-primary btn-md
                shadow-none
                dropdown-toggle dropdown-toggle-split
              " data-bs-toggle="dropdown" aria-expanded="false">
              <span class="visually-hidden">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
              <li>
                <h6 class="dropdown-header">Available Audio Sources</h6>
              </li>
              <select id="audio-select" class="form-select form-select-sm shadow-none"></select>
            </ul>
          </div>
          <div class="btn-group me-2" role="group">
            <button id="start-timer" class="btn btn-outline-info btn-md shadow-none" onclick="rc.startTimer()" hidden>
              <i class="far fa-play-circle"></i>
              Start Meeting
            </button>
          </div>
          <div class="btn-group me-2" role="group">
            <button id='subtask' type="button"
              onclick="get_position_of_mousePointer(event, 'SUBTASK'); openSubtask(); overlay_on();"
              class="btn btn-danger btn-md shadow-none"
              style="border: 1px solid black; margin-top: 10px; margin-right: 30px; float: right;">Start Subtask
            </button>
          </div>
          <!-- <div class="btn-group" role="group">
            <button
              id="screen-share"
              class="btn btn-outline-primary btn-md shadow-none"
              onclick="startScreenSharing()"
            >
              <i class="fas fa-chevron-up"></i>
              Share Screen
            </button>
          </div> -->
        </div>
      </nav>
    </div>

    <div id="right">
      <div class="border bg-light bg-gradient" id="display-choice">
        <p class="h5" style="margin-top: 20px; margin-bottom: 0.5em; display: inline-block;"><strong>[ AI Moderator
            ]</strong></p>

        <!-- <div class="dropdown"
          style="display: block; margin-top: 20px; margin-right: 20px; float: right; font-size: large;">
          <button style="border-radius: 5px;" onclick="showPinBoxes();">
            <i class="fas fa-thumbtack"></i> Pin <i class="fas fa-caret-down"></i>
          </button>
          <div id="dropdownPin"
            style="z-index: 10; display: none; position: absolute; right: 0; padding: 3px 3px 3px 3px; background-color: lightgray; border-radius: 5px;"
            class="dropdown-pin"></div>
        </div> -->

        <div style="margin-top: 1em; display: none;">
          <input type="text" id="search-word" placeholder="SEARCH" onkeypress="checkEnter(event);">
          <button type="button"
            onclick="addSearchLog(); displayUnitOfBox(); rc.addUserLog(Date.now(), 'CLICK-SEARCH-BUTTON\n');"
            width="50px"
            style="padding: 3.5px; background-color:yellowgreen; margin: 2px; border: none; border-radius: 5px;">
            <!--<img src="/img/search.png" width="30px" style="padding: 0px; margin: 0px;">-->
            <i class="fas fa-search" width="30px" ,
              style="padding: 0px; color:white; background-color: transparent; margin: 0px;"></i>
          </button>
          <button type="button" onclick="showAllBoxes(); rc.addUserLog(Date.now(), 'CLICK-SHOW-ALL-BUTTON\n');"
            width="30px"
            style="padding: 3px; background-color:palevioletred; margin: 2px; border: none; border-radius: 5px;">
            <i class="fas fa-backspace" width="30px" ,
              style="padding: 0px; color:white; background-color: transparent; margin: 0px;"></i>
          </button>
        </div>

        <!--Add buttons for trending keyword-->
        <div id="keywords-list" style="margin-top: 5px;">
          <p style="font-size: x-large; display: inline-block; margin-bottom: 5px;"><strong>Popular Keywords: </strong>
          </p>
          <button onclick="returnTrending();"
            style="border-radius: 5px; float: right; margin-right: 20px; font-size: medium;">Return</button>
        </div>
      </div>
      <div id="messages" style="clear: both;"></div>


      <button id="scrollbtn" type="button"
        onclick="scrollDown(); rc.addUserLog(Date.now(), 'CLICK-SCROLL-DOWN-BUTTON\n');" width="80px"
        style="padding: 0px; margin: 0px; border: none; border-radius: 0px;">
        <img src="/img/scrolldownbtn.png" style="width: 100px;" style="padding: 0px; margin: 0px;">
      </button>
  </body>

  <footer>
    <script>
      const room_id = "<%= room_id %>";
      const room_name = "<%= room_name%>";
      const user_name = "<%= user_name %>";
      const moderator_hostname = "<%= moderator_hostname %>";
      const moderator_port = "<%= moderator_port %>";
    </script>
    <script src="/js/conference.js"></script>
    <script src="/js/speech.js"></script>
    <script src="/js/transcript.js"></script>
    <script src="/js/notepad.js"></script>
  </footer>

</html>
